echo "ðŸ” ExÃ©cution des vÃ©rifications pre-commit..."

# RÃ©cupÃ¨re les fichiers staged
CHANGED_FILES=$(git diff --cached --name-only)

# DÃ©tecte les changements pour le website
if echo "$CHANGED_FILES" | grep -q "^apps/utopia-website/.*\.(js|ts|vue)$"; then
    echo "ðŸ” VÃ©rifications website..."
    npx turbo lint type-check --filter=utopia-website
fi

# DÃ©tecte les changements pour le design system
if echo "$CHANGED_FILES" | grep -q "^packages/utopia/"; then
    echo "ðŸŽ¨ VÃ©rifications design system..."
    npx turbo lint type-check build:tokens --filter=@club-employes/utopia
    
    # CrÃ©e automatiquement un changeset si nÃ©cessaire
    echo "ðŸ“ CrÃ©ation automatique du changeset..."
    
    # CrÃ©er le changeset directement
    TIMESTAMP=$(date +%s)
    CHANGESET_FILE=".changeset/auto-${TIMESTAMP}.md"
    BRANCH_NAME=$(git branch --show-current)
    
    cat > "$CHANGESET_FILE" << EOF
---
"@club-employes/utopia": minor
---

Updates from branch ${BRANCH_NAME}:
- Design system components updated
EOF
    
    echo "âœ… Changeset crÃ©Ã© : auto-${TIMESTAMP}.md"
    git add "$CHANGESET_FILE"
fi

# Validation globale si changements tokens
if echo "$CHANGED_FILES" | grep -qE "^(apps/utopia-website/.*|packages/utopia/src/tokens/.*)$"; then
    echo "ðŸŽ¨ Validation des tokens du design system..."
    npx turbo validate:design-system --filter=utopia-website
fi

echo "âœ… Toutes les vÃ©rifications sont passÃ©es !"
