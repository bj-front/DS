echo "ğŸ” ExÃ©cution des vÃ©rifications pre-commit..."

# RÃ©cupÃ¨re les fichiers staged
CHANGED_FILES=$(git diff --cached --name-only)

# DÃ©tecte les changements pour le website
if echo "$CHANGED_FILES" | grep -q "^apps/utopia-website/.*\.(js|ts|vue)$"; then
    echo "ğŸ” VÃ©rifications website..."
    npx turbo lint type-check --filter=utopia-website
fi

# DÃ©tecte les changements pour le design system
if echo "$CHANGED_FILES" | grep -q "^packages/utopia/.*\.(js|ts|vue)$"; then
    echo "ğŸ¨ VÃ©rifications design system..."
    npx turbo lint type-check build:tokens --filter=@club-employes/utopia
    
    # CrÃ©e automatiquement un changeset si nÃ©cessaire
    echo "ğŸ“ VÃ©rification changeset..."
    node scripts/auto-changeset.js
fi

# Validation globale si changements tokens
if echo "$CHANGED_FILES" | grep -qE "^(apps/utopia-website/.*|packages/utopia/src/tokens/.*)$"; then
    echo "ğŸ¨ Validation des tokens du design system..."
    npx turbo validate:design-system --filter=utopia-website
fi

echo "âœ… Toutes les vÃ©rifications sont passÃ©es !"
